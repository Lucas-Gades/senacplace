<div class="container py-3">
  <h4 class="text-center text-success fw-bold mb-2">Anunciar Produto</h4>
  <p class="text-center text-muted mb-4 small">Complete as informações para publicar seu produto</p>

  <form (ngSubmit)="salvar()" #formProduto="ngForm" novalidate>

    <!-- usuarioId (hidden) -->
    <input type="hidden" [(ngModel)]="produto.usuarioId" name="usuarioId" />

    <div class="row g-2 mb-3">
      <div class="col-12 col-md-4">
        <label class="form-label small fw-bold">Fotos do Produto</label>
        <input type="file" class="form-control form-control-sm" multiple accept="image/*" />
        <small class="text-muted">JPG/PNG até 5MB</small>
      </div>

      <div class="col-12 col-md-8">
        <label class="form-label small fw-bold">Título do anúncio</label>
        <input type="text" class="form-control form-control-sm" placeholder="Título"
               [(ngModel)]="produto.titulo" name="titulo" required #titulo="ngModel" />
        <div class="text-danger small" *ngIf="formProduto.submitted && titulo.invalid">
          Título obrigatório.
        </div>
      </div>
    </div>

    <div class="row g-2 mb-3">
      <div class="col-12 col-md-4">
        <label class="form-label small fw-bold">Categoria</label>
        <select class="form-select form-select-sm" [(ngModel)]="produto.categoria" name="categoria" required #categoria="ngModel">
          <option value="" disabled>Selecione</option>
          @for (cat of listaCategorias; track cat.id) {
            <option [value]="cat.nomecategoria">{{ cat.nomecategoria }}</option>
          }
        </select>
        <div class="text-danger small" *ngIf="formProduto.submitted && categoria.invalid">
          Selecione uma categoria.
        </div>
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label small fw-bold">Condição</label>
        <select class="form-select form-select-sm" [(ngModel)]="produto.condicao" name="condicao" required #condicao="ngModel">
          <option value="" disabled>Selecione</option>
          <option value="Novo">Novo</option>
          <option value="Semi-novo">Semi-novo</option>
          <option value="Usado">Usado</option>
          <option value="Com defeito">Com defeito</option>
        </select>
        <div class="text-danger small" *ngIf="formProduto.submitted && condicao.invalid">
          Selecione a condição.
        </div>
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label small fw-bold">Preço (R$)</label>
        <input type="number" class="form-control form-control-sm" placeholder="Preço"
               [(ngModel)]="produto.preco" name="preco" min="0.01" required #preco="ngModel" />
        <div class="text-danger small" *ngIf="formProduto.submitted && preco.invalid">
          Insira um preço válido.
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label small fw-bold">Descrição</label>
      <textarea class="form-control form-control-sm" rows="3" placeholder="Descrição do produto..."
                [(ngModel)]="produto.descricao" name="descricao" #descricao="ngModel"></textarea>
    </div>

    <!-- Cidades do Sul (RS) -->
    <div class="row g-2 mb-3">
      <div class="col-12 col-md-6">
        <label class="form-label small fw-bold">Cidade</label>
        <select class="form-select form-select-sm" [(ngModel)]="produto.cidade" name="cidade" required #cidade="ngModel">
          <option value="" disabled>Selecione</option>
          <option value="Porto Alegre">Porto Alegre</option>
          <option value="Gravataí">Gravataí</option>
          <option value="Alvorada">Alvorada</option>
          <option value="Canoas">Canoas</option>
          <option value="Viamão">Viamão</option>
          <option value="São Leopoldo">São Leopoldo</option>
          <option value="Pelotas">Pelotas</option>
          <option value="Santa Maria">Santa Maria</option>
          <option value="Caxias do Sul">Caxias do Sul</option>
          <option value="Rio Grande">Rio Grande</option>
          <option value="Novo Hamburgo">Novo Hamburgo</option>
          <option value="Bagé">Bagé</option>
        </select>
        <div class="text-danger small" *ngIf="formProduto.submitted && cidade.invalid">
          Selecione uma cidade.
        </div>
      </div>

      <div class="col-12 col-md-6">
        <label class="form-label small fw-bold">Contato</label>
        <input type="text" class="form-control form-control-sm"
               placeholder="Número (ex: 51999999999)"
               [(ngModel)]="produto.contato" name="contato" maxlength="11" required
               pattern="^[0-9]{11}$" #contato="ngModel" (blur)="validarCelular()" />
        <div class="text-danger small" *ngIf="formProduto.submitted && contato.invalid">
          Número inválido! Deve conter 11 dígitos (DDD + número).
        </div>
      </div>
    </div>

    <!-- mostra a data de publicação (será preenchida no salvar) -->
    <div class="mb-3">
      <label class="form-label small fw-bold">Data de publicação</label>
      <input type="text" class="form-control form-control-sm" [value]="produto.dataPublicacao ? (produto.dataPublicacao | date:'short') : ''" readonly />
    </div>

    <div class="d-grid mb-3">
      <button type="submit" class="btn btn-success btn-sm fw-bold" [disabled]="formProduto.invalid">
        {{ botaoAcao }}
      </button>
    </div>
  </form>

  <pre class="small">{{ produto | json }}</pre>
</div>